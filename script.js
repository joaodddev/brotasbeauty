// Dados do aplicativo
const appData = {
  currentStep: "service-selection",
  selectedService: null,
  selectedProfessional: null,
  selectedDate: null,
  selectedTime: null,

  services: {
    unhas: {
      name: "Unhas",
      professionals: ["Clau", "Leticia", "Gislaine", "Raquel"],
      specialties: {
        Clau: ["Manicure", "Pedicure", "Esmalta√ß√£o em Gel"],
        Leticia: ["Alongamento", "Manuten√ß√£o", "Unhas Art√≠sticas"],
        Gislaine: ["Manicure", "Pedicure", "SPA das M√£os"],
        Raquel: ["Alongamento", "Francesinha", "Decora√ß√µes"],
      },
    },
    sobrancelhas: {
      name: "Sobrancelhas",
      professionals: ["Clau", "Leticia", "Gislaine"],
      specialties: {
        Clau: ["Design", "Henna", "Aplica√ß√£o de Cera"],
        Leticia: ["Design", "Micropigmenta√ß√£o", "Reconstru√ß√£o"],
        Gislaine: ["Design", "Henna", "Limpeza de Pele"],
      },
    },
    cilios: {
      name: "C√≠lios",
      professionals: ["Leticia", "Raquel"],
      specialties: {
        Leticia: ["Volume Brasileiro", "Fio a Fio", "Lifting"],
        Raquel: ["Volume Russo", "H√≠brido", "Mega Volume"],
      },
    },
    skincare: {
      name: "Skincare",
      professionals: ["Gislaine", "Raquel"],
      specialties: {
        Gislaine: ["Limpeza de Pele", "Hidrata√ß√£o", "Peeling"],
        Raquel: ["Tratamentos Faciais", "Drenagem", "Massagem Relaxante"],
      },
    },
  },

  // Hor√°rio de funcionamento
  businessHours: {
    start: 7, // 7:00
    end: 17.5, // 17:30 (17.5 horas)
    interval: 0.5, // 30 minutos
  },

  // Datas indispon√≠veis (simula√ß√£o)
  unavailableDates: ["2023-12-25", "2023-12-31", "2024-01-01"],
};

// Inicializa√ß√£o do aplicativo
document.addEventListener("DOMContentLoaded", function () {
  initializeApp();
});

function initializeApp() {
  // Configurar navega√ß√£o de servi√ßos
  setupServiceNavigation();

  // Configurar sele√ß√£o de servi√ßos
  setupServiceSelection();

  // Configurar bot√µes de voltar
  setupBackButtons();

  // Configurar formul√°rio de agendamento
  setupBookingForm();

  // Inicializar calend√°rio
  initializeCalendar();
}

// Navega√ß√£o entre servi√ßos
function setupServiceNavigation() {
  const serviceLinks = document.querySelectorAll(".service-link");

  serviceLinks.forEach((link) => {
    link.addEventListener("click", function (e) {
      e.preventDefault();

      // Remover classe active de todos os links
      serviceLinks.forEach((l) => l.classList.remove("active"));

      // Adicionar classe active ao link clicado
      this.classList.add("active");

      // Atualizar servi√ßo selecionado
      const service = this.getAttribute("data-service");
      appData.selectedService = service;

      // Ir para sele√ß√£o de profissional
      showSection("professional-selection");

      // Carregar profissionais do servi√ßo selecionado
      loadProfessionals(service);
    });
  });
}

// Sele√ß√£o de servi√ßos pelos cards
function setupServiceSelection() {
  const serviceCards = document.querySelectorAll(".service-card");

  serviceCards.forEach((card) => {
    card.addEventListener("click", function () {
      const service = this.getAttribute("data-service");
      appData.selectedService = service;

      // Atualizar navega√ß√£o ativa
      const serviceLinks = document.querySelectorAll(".service-link");
      serviceLinks.forEach((link) => {
        link.classList.remove("active");
        if (link.getAttribute("data-service") === service) {
          link.classList.add("active");
        }
      });

      // Ir para sele√ß√£o de profissional
      showSection("professional-selection");

      // Carregar profissionais do servi√ßo selecionado
      loadProfessionals(service);
    });
  });
}

// Carregar profissionais para o servi√ßo selecionado
function loadProfessionals(service) {
  const professionalsGrid = document.querySelector(".professionals-grid");
  professionalsGrid.innerHTML = "";

  const serviceData = appData.services[service];
  const emojis = {
    Clau: "üíÖ",
    Leticia: "‚ú®",
    Gislaine: "üå∏",
    Raquel: "üåü",
  };

  serviceData.professionals.forEach((professional) => {
    const professionalCard = document.createElement("div");
    professionalCard.className = "professional-card";
    professionalCard.setAttribute("data-professional", professional);

    const specialties = serviceData.specialties[professional];
    const specialtiesHTML = specialties
      .map((spec) => `<span class="specialty-tag">${spec}</span>`)
      .join("");

    professionalCard.innerHTML = `
            <div class="professional-photo">${emojis[professional]}</div>
            <h3>${professional}</h3>
            <p>Especialista em ${serviceData.name.toLowerCase()}</p>
            <div class="professional-specialties">
                ${specialtiesHTML}
            </div>
        `;

    professionalCard.addEventListener("click", function () {
      // Remover sele√ß√£o anterior
      document.querySelectorAll(".professional-card").forEach((card) => {
        card.classList.remove("selected");
      });

      // Adicionar sele√ß√£o atual
      this.classList.add("selected");

      // Salvar profissional selecionado
      appData.selectedProfessional = professional;

      // Ir para sele√ß√£o de data e hor√°rio
      showSection("datetime-selection");

      // Atualizar calend√°rio
      initializeCalendar();
    });

    professionalsGrid.appendChild(professionalCard);
  });
}

// Inicializar calend√°rio
function initializeCalendar() {
  const calendar = document.getElementById("calendar");
  calendar.innerHTML = "";

  // Configurar data atual
  const today = new Date();
  const currentMonth = today.getMonth();
  const currentYear = today.getFullYear();

  // Criar cabe√ßalho do calend√°rio
  const calendarHeader = document.createElement("div");
  calendarHeader.className = "calendar-header";

  const monthNames = [
    "Janeiro",
    "Fevereiro",
    "Mar√ßo",
    "Abril",
    "Maio",
    "Junho",
    "Julho",
    "Agosto",
    "Setembro",
    "Outubro",
    "Novembro",
    "Dezembro",
  ];

  calendarHeader.innerHTML = `
        <button id="prev-month">&larr;</button>
        <div class="calendar-month">${monthNames[currentMonth]} ${currentYear}</div>
        <button id="next-month">&rarr;</button>
    `;

  calendar.appendChild(calendarHeader);

  // Adicionar dias da semana
  const weekdays = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "S√°b"];
  weekdays.forEach((weekday) => {
    const weekdayElement = document.createElement("div");
    weekdayElement.className = "calendar-weekday";
    weekdayElement.textContent = weekday;
    calendar.appendChild(weekdayElement);
  });

  // Calcular primeiro dia do m√™s
  const firstDay = new Date(currentYear, currentMonth, 1).getDay();

  // Calcular √∫ltimo dia do m√™s
  const lastDay = new Date(currentYear, currentMonth + 1, 0).getDate();

  // Adicionar dias vazios no in√≠cio
  for (let i = 0; i < firstDay; i++) {
    const emptyDay = document.createElement("div");
    emptyDay.className = "calendar-day empty";
    calendar.appendChild(emptyDay);
  }

  // Adicionar dias do m√™s
  for (let day = 1; day <= lastDay; day++) {
    const dayElement = document.createElement("div");
    dayElement.className = "calendar-day";
    dayElement.textContent = day;

    // Formatar data para compara√ß√£o
    const dateString = `${currentYear}-${String(currentMonth + 1).padStart(
      2,
      "0"
    )}-${String(day).padStart(2, "0")}`;

    // Verificar se a data est√° dispon√≠vel
    const isToday =
      day === today.getDate() &&
      currentMonth === today.getMonth() &&
      currentYear === today.getFullYear();
    const isPast =
      new Date(currentYear, currentMonth, day) <
      new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const isUnavailable = appData.unavailableDates.includes(dateString);
    const isSunday = new Date(currentYear, currentMonth, day).getDay() === 0;

    if (isToday) {
      dayElement.classList.add("today");
    }

    if (isPast || isUnavailable || isSunday) {
      dayElement.classList.add("disabled");
    } else {
      dayElement.addEventListener("click", function () {
        // Remover sele√ß√£o anterior
        document.querySelectorAll(".calendar-day").forEach((dayEl) => {
          dayEl.classList.remove("selected");
        });

        // Adicionar sele√ß√£o atual
        this.classList.add("selected");

        // Salvar data selecionada
        appData.selectedDate = dateString;

        // Carregar hor√°rios dispon√≠veis
        loadTimeSlots();
      });
    }

    calendar.appendChild(dayElement);
  }

  // Configurar navega√ß√£o do calend√°rio
  document.getElementById("prev-month").addEventListener("click", function () {
    // Navegar para m√™s anterior (simula√ß√£o)
    alert(
      "Funcionalidade de navega√ß√£o entre meses ser√° implementada na vers√£o completa."
    );
  });

  document.getElementById("next-month").addEventListener("click", function () {
    // Navegar para pr√≥ximo m√™s (simula√ß√£o)
    alert(
      "Funcionalidade de navega√ß√£o entre meses ser√° implementada na vers√£o completa."
    );
  });
}

// Carregar hor√°rios dispon√≠veis
function loadTimeSlots() {
  const timeSlotsContainer = document.getElementById("time-slots");
  timeSlotsContainer.innerHTML = "";

  // Gerar hor√°rios baseados no hor√°rio de funcionamento
  const slots = generateTimeSlots();

  // Simular alguns hor√°rios indispon√≠veis
  const unavailableSlots = ["10:00", "14:30", "16:00"];

  slots.forEach((slot) => {
    const timeSlot = document.createElement("div");
    timeSlot.className = "time-slot";

    if (unavailableSlots.includes(slot)) {
      timeSlot.classList.add("disabled");
      timeSlot.textContent = slot;
    } else {
      timeSlot.textContent = slot;
      timeSlot.addEventListener("click", function () {
        // Remover sele√ß√£o anterior
        document.querySelectorAll(".time-slot").forEach((slotEl) => {
          slotEl.classList.remove("selected");
        });

        // Adicionar sele√ß√£o atual
        this.classList.add("selected");

        // Salvar hor√°rio selecionado
        appData.selectedTime = slot;

        // Atualizar resumo
        updateBookingSummary();

        // Ir para formul√°rio de agendamento
        showSection("booking-form");
      });
    }

    timeSlotsContainer.appendChild(timeSlot);
  });
}

// Gerar hor√°rios baseados no hor√°rio de funcionamento
function generateTimeSlots() {
  const slots = [];
  const start = appData.businessHours.start;
  const end = appData.businessHours.end;
  const interval = appData.businessHours.interval;

  for (let hour = start; hour < end; hour += interval) {
    const hourInt = Math.floor(hour);
    const minutes = (hour % 1) * 60;
    const timeString = `${hourInt.toString().padStart(2, "0")}:${minutes
      .toString()
      .padStart(2, "0")}`;
    slots.push(timeString);
  }

  return slots;
}

// Atualizar resumo do agendamento
function updateBookingSummary() {
  document.getElementById("summary-service").textContent =
    appData.services[appData.selectedService].name;
  document.getElementById("summary-professional").textContent =
    appData.selectedProfessional;

  // Formatar data
  const date = new Date(appData.selectedDate);
  const formattedDate = date.toLocaleDateString("pt-BR", {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  });

  document.getElementById("summary-date").textContent = formattedDate;
  document.getElementById("summary-time").textContent = appData.selectedTime;
}

// Configurar formul√°rio de agendamento
function setupBookingForm() {
  const bookingForm = document.getElementById("client-form");

  bookingForm.addEventListener("submit", function (e) {
    e.preventDefault();

    // Validar formul√°rio
    const name = document.getElementById("client-name").value;
    const phone = document.getElementById("client-phone").value;

    if (!name || !phone) {
      alert("Por favor, preencha pelo menos o nome e telefone.");
      return;
    }

    // Enviar para WhatsApp
    sendToWhatsApp();
  });
}

// Enviar agendamento para WhatsApp
function sendToWhatsApp() {
  const name = document.getElementById("client-name").value;
  const phone = document.getElementById("client-phone").value;
  const email = document.getElementById("client-email").value;
  const notes = document.getElementById("client-notes").value;

  // Formatar data
  const date = new Date(appData.selectedDate);
  const formattedDate = date.toLocaleDateString("pt-BR");

  // Criar mensagem
  let message = `üå∏ *NOVO AGENDAMENTO - BROTAS BEAUTY* üå∏\n\n`;
  message += `*Cliente:* ${name}\n`;
  message += `*Telefone:* ${phone}\n`;
  if (email) message += `*E-mail:* ${email}\n`;
  message += `\n*üìã DETALHES DO AGENDAMENTO:*\n`;
  message += `‚Ä¢ Servi√ßo: ${appData.services[appData.selectedService].name}\n`;
  message += `‚Ä¢ Profissional: ${appData.selectedProfessional}\n`;
  message += `‚Ä¢ Data: ${formattedDate}\n`;
  message += `‚Ä¢ Hor√°rio: ${appData.selectedTime}\n`;
  if (notes) message += `‚Ä¢ Observa√ß√µes: ${notes}\n`;
  message += `\n_Agendamento realizado via site_`;

  // Codificar mensagem para URL
  const encodedMessage = encodeURIComponent(message);

  // N√∫mero do WhatsApp do sal√£o
  const whatsappNumber = "5514991244578";

  // Criar URL do WhatsApp
  const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;

  // Abrir WhatsApp
  window.open(whatsappURL, "_blank");

  // Mostrar confirma√ß√£o
  showConfirmation();
}

// Mostrar confirma√ß√£o
function showConfirmation() {
  // Atualizar confirma√ß√£o
  document.getElementById("confirm-service").textContent =
    appData.services[appData.selectedService].name;
  document.getElementById("confirm-professional").textContent =
    appData.selectedProfessional;

  // Formatar data
  const date = new Date(appData.selectedDate);
  const formattedDate = date.toLocaleDateString("pt-BR", {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  });

  document.getElementById("confirm-date").textContent = formattedDate;
  document.getElementById("confirm-time").textContent = appData.selectedTime;

  // Mostrar confirma√ß√£o
  showSection("booking-confirmation");
}

// Configurar bot√µes de voltar
function setupBackButtons() {
  // Voltar para servi√ßos
  document
    .getElementById("back-to-services")
    .addEventListener("click", function () {
      showSection("service-selection");
    });

  // Voltar para profissionais
  document
    .getElementById("back-to-professionals")
    .addEventListener("click", function () {
      showSection("professional-selection");
    });

  // Voltar para data/hor√°rio
  document
    .getElementById("back-to-datetime")
    .addEventListener("click", function () {
      showSection("datetime-selection");
    });

  // Novo agendamento
  document.getElementById("new-booking").addEventListener("click", function () {
    // Resetar dados
    appData.selectedService = null;
    appData.selectedProfessional = null;
    appData.selectedDate = null;
    appData.selectedTime = null;

    // Resetar formul√°rio
    document.getElementById("client-form").reset();

    // Voltar para in√≠cio
    showSection("service-selection");

    // Resetar navega√ß√£o
    document.querySelectorAll(".service-link").forEach((link) => {
      link.classList.remove("active");
    });

    document
      .querySelector('.service-link[data-service="unhas"]')
      .classList.add("active");
  });
}

// Mostrar se√ß√£o espec√≠fica
function showSection(sectionId) {
  // Esconder todas as se√ß√µes
  document.querySelectorAll(".section").forEach((section) => {
    section.classList.remove("active");
  });

  // Mostrar se√ß√£o desejada
  document.getElementById(sectionId).classList.add("active");

  // Atualizar passo atual
  appData.currentStep = sectionId;

  // Rolagem para o topo
  window.scrollTo(0, 0);
}
// Enviar agendamento para WhatsApp
function sendToWhatsApp() {
  const name = document.getElementById("client-name").value;
  const phone = document.getElementById("client-phone").value;
  const email = document.getElementById("client-email").value;
  const notes = document.getElementById("client-notes").value;

  // Formatar data
  const date = new Date(appData.selectedDate);
  const formattedDate = date.toLocaleDateString("pt-BR");

  // Criar mensagem
  let message = `üå∏ *NOVO AGENDAMENTO - BROTAS BEAUTY* üå∏\n\n`;
  message += `*Cliente:* ${name}\n`;
  message += `*Telefone:* ${phone}\n`;
  if (email) message += `*E-mail:* ${email}\n`;
  message += `\n*üìã DETALHES DO AGENDAMENTO:*\n`;
  message += `‚Ä¢ Servi√ßo: ${appData.services[appData.selectedService].name}\n`;
  message += `‚Ä¢ Profissional: ${appData.selectedProfessional}\n`;
  message += `‚Ä¢ Data: ${formattedDate}\n`;
  message += `‚Ä¢ Hor√°rio: ${appData.selectedTime}\n`;
  if (notes) message += `‚Ä¢ Observa√ß√µes: ${notes}\n`;
  message += `\n_Agendamento realizado via site_`;

  // Codificar mensagem para URL
  const encodedMessage = encodeURIComponent(message);

  // N√∫mero do WhatsApp do sal√£o
  const whatsappNumber = "5514991244578";

  // Criar URL do WhatsApp
  const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;

  // Abrir WhatsApp em nova aba
  window.open(whatsappURL, "_blank");

  // Mostrar confirma√ß√£o
  showConfirmation();
}

// Mostrar confirma√ß√£o
function showConfirmation() {
  // Atualizar confirma√ß√£o
  document.getElementById("confirm-service").textContent =
    appData.services[appData.selectedService].name;
  document.getElementById("confirm-professional").textContent =
    appData.selectedProfessional;

  // Formatar data
  const date = new Date(appData.selectedDate);
  const formattedDate = date.toLocaleDateString("pt-BR", {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  });

  document.getElementById("confirm-date").textContent = formattedDate;
  document.getElementById("confirm-time").textContent = appData.selectedTime;

  // Adicionar links de contato na confirma√ß√£o
  addContactLinksToConfirmation();

  // Mostrar confirma√ß√£o
  showSection("booking-confirmation");
}

// Adicionar links de contato na p√°gina de confirma√ß√£o
function addContactLinksToConfirmation() {
  const confirmationDetails = document.querySelector(".confirmation-details");

  // Verificar se os links j√° existem
  if (!document.querySelector(".confirmation-links")) {
    const linksHTML = `
            <div class="confirmation-links">
                <a href="https://wa.me/5514991244578" target="_blank" class="confirmation-link whatsapp">
                    <i class="fab fa-whatsapp"></i> Falar no WhatsApp
                </a>
                <a href="https://maps.google.com/?q=Brotas,SP" target="_blank" class="confirmation-link maps">
                    <i class="fas fa-map-marker-alt"></i> Ver Localiza√ß√£o
                </a>
            </div>
        `;

    // Inserir antes do bot√£o de novo agendamento
    const newBookingBtn = document.getElementById("new-booking");
    newBookingBtn.insertAdjacentHTML("beforebegin", linksHTML);
  }
}

// Configurar links de contato no rodap√©
function setupContactLinks() {
  // Os links no rodap√© j√° est√£o configurados no HTML
  // Esta fun√ß√£o √© para garantir que funcionem corretamente
  const contactLinks = document.querySelectorAll(".contact-link");
  contactLinks.forEach((link) => {
    link.addEventListener("click", function (e) {
      // O target="_blank" no HTML j√° cuida de abrir em nova aba
      // N√£o precisamos prevenir o comportamento padr√£o
    });
  });
}

// Inicializa√ß√£o do aplicativo (atualizada)
document.addEventListener("DOMContentLoaded", function () {
  initializeApp();
  setupContactLinks(); // Configurar links de contato
});
